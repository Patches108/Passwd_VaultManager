<Window
    x:Class="Passwd_VaultManager.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:Menu="clr-namespace:Passwd_VaultManager.Utils"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:Passwd_VaultManager"
    xmlns:m="clr-namespace:Passwd_VaultManager.Models"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:v="clr-namespace:Passwd_VaultManager.Views"
    xmlns:vm="clr-namespace:Passwd_VaultManager.ViewModels"
    Title="Password Vault Manager"
    Width="550"
    Height="700"
    Background="Transparent"
    Closing="MainWindow_Closing"
    Loaded="frmMainWindow_Loaded"
    ResizeMode="NoResize"
    Style="{StaticResource WinStyle}"
    WindowStartupLocation="CenterScreen"
    mc:Ignorable="d">

    <Window.Resources>
        <!--  Shared VM  -->
        <vm:PasswdPanelVM x:Key="PasswdPanelVM" />
    </Window.Resources>

    <Window.DataContext>
        <StaticResource ResourceKey="PasswdPanelVM" />
    </Window.DataContext>


    <!--  Press Delete key  -->
    <Window.InputBindings>
        <KeyBinding
            Key="Delete"
            Command="{Binding DeleteVaultEntryCommand}"
            CommandParameter="{Binding SelectedAppVault}" />
    </Window.InputBindings>

    <Border CornerRadius="8" Style="{StaticResource FormStyle}">
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="100" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
                <RowDefinition Height="25" />
                <!--  Menu slot  -->
                <RowDefinition Height="50" />
                <RowDefinition Height="*" />
                <RowDefinition Height="80" />
            </Grid.RowDefinitions>

            <Menu
                x:Name="MainMenu"
                Grid.Row="0"
                Grid.Column="0"
                ItemContainerStyle="{StaticResource MenuItem}"
                Style="{StaticResource MenuHeaderStyle}">
                <MenuItem Header="Operations">
                    <MenuItem Click="NewVaultRecord_Click" Header="New" />
                    <MenuItem Click="EditVaultRecord_Click" Header="Edit" />
                    <Separator Style="{StaticResource MenuSeparator}" />
                    <MenuItem Click="DeleteVaultRecord_Click" Header="Delete" />
                    <Separator Style="{StaticResource MenuSeparator}" />
                    <MenuItem Click="ExitApp_Click" Header="Exit" />
                </MenuItem>
            </Menu>

            <!--  Left Panel Space  -->
            <StackPanel
                Grid.Row="2"
                Grid.Column="0"
                Margin="2,10,2,10">

                <!--  Command="{Binding NewVaultEntryCommand}"  -->
                <Menu:MenuCmd
                    Width="90"
                    Height="35"
                    Margin="0,5,0,5"
                    Command="{Binding NewVaultEntryCommand}"
                    IsChecked="False"
                    Style="{StaticResource SideCmdStyle}">
                    <!--  NEW BUTTON  -->
                    <Grid Margin="-10,0,0,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <Image
                            x:Name="img_NewRecord"
                            Grid.Column="0"
                            Width="25"
                            Height="25">
                            <Image.Source>
                                <BitmapImage UriSource="Images/New.png" />
                            </Image.Source>
                        </Image>
                        <TextBlock
                            x:Name="cmd_NewRecord"
                            Grid.Column="1"
                            Width="40"
                            Height="17"
                            Margin="5,7,0,0"
                            VerticalAlignment="Top"
                            Style="{StaticResource TextStyle}"
                            Text="New" />
                    </Grid>
                </Menu:MenuCmd>

                <!--  EDIT BUTTON  -->
                <Menu:MenuCmd
                    Width="90"
                    Height="35"
                    Margin="0,5,0,5"
                    Command="{Binding EditVaultEntryCommand}"
                    CommandParameter="{Binding SelectedAppVault, Source={StaticResource PasswdPanelVM}}"
                    IsChecked="False"
                    Style="{StaticResource SideCmdStyle}">
                    <Grid Margin="-10,0,0,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <Image
                            x:Name="img_EditRecord"
                            Grid.Column="0"
                            Width="25"
                            Height="25">
                            <Image.Source>
                                <BitmapImage UriSource="Images/Edit.png" />
                            </Image.Source>
                        </Image>
                        <TextBlock
                            x:Name="cmd_EditRecord"
                            Grid.Column="1"
                            Width="40"
                            Height="17"
                            Margin="5,7,0,0"
                            VerticalAlignment="Top"
                            Style="{StaticResource TextStyle}"
                            Text="Edit" />
                    </Grid>
                </Menu:MenuCmd>


                <!--  DELETE BUTTON  -->
                <Menu:MenuCmd
                    Width="90"
                    Height="35"
                    Margin="0,5,0,5"
                    Command="{Binding DeleteVaultEntryCommand}"
                    CommandParameter="{Binding SelectedAppVault}"
                    IsChecked="False"
                    Style="{StaticResource SideCmdStyle}">
                    <Grid Margin="-10,0,0,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <Image
                            x:Name="img_DeleteRecord"
                            Grid.Column="0"
                            Width="25"
                            Height="25">
                            <Image.Source>
                                <BitmapImage UriSource="Images/Delete.png" />
                            </Image.Source>
                        </Image>
                        <TextBlock
                            x:Name="cmd_DeleteRecord"
                            Grid.Column="1"
                            Width="45"
                            Height="17"
                            Margin="5,7,0,0"
                            VerticalAlignment="Top"
                            Style="{StaticResource TextStyle}"
                            Text="Delete" />
                    </Grid>
                </Menu:MenuCmd>
            </StackPanel>

            <ScrollViewer Grid.Row="2" Grid.Column="1">
                <ListBox
                    Background="Transparent"
                    BorderThickness="0"
                    ItemsSource="{Binding Vaults}"
                    SelectedItem="{Binding SelectedAppVault}">

                    <!--  Bind double-click & Enter at the ListBox level  -->
                    <ListBox.InputBindings>
                        <MouseBinding
                            Command="{Binding DataContext.EditVaultEntryCommand, RelativeSource={RelativeSource AncestorType=ListBox}}"
                            CommandParameter="{Binding SelectedItem, RelativeSource={RelativeSource AncestorType=ListBox}}"
                            MouseAction="LeftDoubleClick" />
                        <KeyBinding
                            Key="Enter"
                            Command="{Binding DataContext.EditVaultEntryCommand, RelativeSource={RelativeSource AncestorType=ListBox}}"
                            CommandParameter="{Binding SelectedItem, RelativeSource={RelativeSource AncestorType=ListBox}}" />
                    </ListBox.InputBindings>

                    <ListBox.ItemContainerStyle>
                        <Style TargetType="ListBoxItem">
                            <Setter Property="Padding" Value="0" />
                            <Setter Property="BorderThickness" Value="0" />
                            <Setter Property="Background" Value="Transparent" />
                            <Style.Triggers>
                                <Trigger Property="IsSelected" Value="True">
                                    <Setter Property="BorderBrush" Value="#FF27D644" />
                                    <Setter Property="BorderThickness" Value="3" />
                                    <Setter Property="Background" Value="#1A27D644" />
                                </Trigger>
                            </Style.Triggers>

                        </Style>
                    </ListBox.ItemContainerStyle>

                    <ListBox.ItemTemplate>
                        <DataTemplate DataType="{x:Type m:AppVault}">
                            <v:PasswordPanel />
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
            </ScrollViewer>

            <!--<ScrollViewer Grid.Row="2" Grid.Column="1">
                <ItemsControl ItemsSource="{Binding Vaults}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate DataType="{x:Type m:AppVault}">
                            <v:PasswordPanel />
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </ScrollViewer>-->


            <!--  Footer Controls  -->
            <Grid Grid.Row="3" Grid.Column="1">
                <TextBlock
                    x:Name="lblStat"
                    Margin="50,0,0,0"
                    HorizontalAlignment="Left"
                    VerticalAlignment="Center"
                    Style="{StaticResource StatusText}"
                    Text="Status" />

                <Button
                    x:Name="cmd_Close"
                    Margin="0,0,10,0"
                    HorizontalAlignment="Right"
                    VerticalAlignment="Center"
                    Click="cmdClose_Click"
                    Content="Close"
                    Style="{StaticResource ControlButton}" />
            </Grid>
        </Grid>
    </Border>
</Window>
