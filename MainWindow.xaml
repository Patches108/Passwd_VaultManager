<Window
    x:Class="Passwd_VaultManager.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:Menu="clr-namespace:Passwd_VaultManager.Utils"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:Passwd_VaultManager"
    xmlns:m="clr-namespace:Passwd_VaultManager.Models"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:v="clr-namespace:Passwd_VaultManager.Views"
    xmlns:vm="clr-namespace:Passwd_VaultManager.ViewModels"
    Title="Password Vault Manager"
    Width="550"
    Height="700"
    Background="Transparent"
    Closing="MainWindow_Closing"
    Loaded="frmMainWindow_Loaded"
    ResizeMode="CanMinimize"
    Style="{StaticResource WinStyle}"
    WindowStartupLocation="CenterScreen"
    mc:Ignorable="d">

    <Window.Resources>
        <!--  Shared VM  -->
        <vm:PasswdPanelVM x:Key="PasswdPanelVM" />

        <!--  Context menu for Filer icon  -->
        <ContextMenu x:Key="FilterContextMenu" Style="{StaticResource ContextMenuStyle}">
            <MenuItem Click="FilterMenu_IsPasswdSet_Click" Header="Password Set?" />
            <MenuItem Click="FilterMenu_IsUserNameSet_Click" Header="UserName Set?" />
            <Separator Style="{StaticResource MenuSeparator}" />
            <MenuItem Click="FilterMenu_BitRate265_Click" Header="BitRate (265)" />
            <MenuItem Click="FilterMenu_BitRate192_Click" Header="BitRate (192)" />
            <MenuItem Click="FilterMenu_BitRate128OrLess_Click" Header="BitRate (8 &lt;= 128)" />
            <Separator Style="{StaticResource MenuSeparator}" />
            <MenuItem Click="FilterMenu_StatusGood_Click" Header="Status Good" />
            <MenuItem Click="FilterMenu_StatusGood_Click" Header="Status Bad" />
            <Separator Style="{StaticResource MenuSeparator}" />
            <MenuItem Click="FilterMenu_Cancel_Click" Header="Cancel" />
        </ContextMenu>

    </Window.Resources>

    <Window.DataContext>
        <StaticResource ResourceKey="PasswdPanelVM" />
    </Window.DataContext>


    <!--  Press Delete key  -->
    <Window.InputBindings>
        <KeyBinding
            Key="Delete"
            Command="{Binding DeleteVaultEntryCommand}"
            CommandParameter="{Binding SelectedAppVault}" />
    </Window.InputBindings>

    <Border CornerRadius="8" Style="{StaticResource FormStyle}">
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="100" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
                <RowDefinition Height="25" />
                <!--  Menu slot  -->
                <RowDefinition Height="50" />
                <RowDefinition Height="*" />
                <RowDefinition Height="80" />
            </Grid.RowDefinitions>

            <Menu
                x:Name="MainMenu"
                Grid.Row="0"
                Grid.Column="0"
                ItemContainerStyle="{StaticResource MenuItem}"
                Style="{StaticResource MenuHeaderStyle}">
                <MenuItem Header="Operations">
                    <MenuItem Click="NewVaultRecord_Click" Header="New" />
                    <MenuItem Click="EditVaultRecord_Click" Header="Edit" />
                    <MenuItem Click="OpenSettings_Click" Header="Settings" />
                    <Separator Style="{StaticResource MenuSeparator}" />
                    <MenuItem
                        Header="_Run on Startup"
                        IsCheckable="True"
                        IsChecked="{Binding IsStartupEnabled, Mode=TwoWay}" />
                    <Separator Style="{StaticResource MenuSeparator}" />
                    <MenuItem Click="DeleteVaultRecord_Click" Header="Delete" />
                    <Separator Style="{StaticResource MenuSeparator}" />
                    <MenuItem Click="ExitApp_Click" Header="Exit" />
                </MenuItem>
            </Menu>


            <!--  Search/managment controls  -->
            <Grid Grid.Row="1" Grid.Column="1">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="270" />
                    <!--<ColumnDefinition Width="50" />-->
                    <ColumnDefinition Width="50" />
                    <ColumnDefinition Width="50" />
                </Grid.ColumnDefinitions>

                <!--  SEARCH TEXT FIELD.  -->
                <TextBox
                    x:Name="txtSearch"
                    Grid.Column="0"
                    Margin="0,8,5,10"
                    GotFocus="txtSearch_GotFocus"
                    LostFocus="txtSearch_LostFocus"
                    Style="{StaticResource SearchTextField}" />

                <!--  SEARCH BUTTON  -->
                <!--<Button
                    x:Name="cmdSearch"
                    Grid.Column="1"
                    Width="36"
                    Height="30"
                    Style="{StaticResource ControlButton}">
                    <Image
                        Width="20"
                        Height="20"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        Source="/Images/Search.png" />
                </Button>-->


                <!--  FILTER BUTTON  -->
                <Button
                    x:Name="cmdFilter"
                    Grid.Column="1"
                    Width="36"
                    Height="30"
                    Click="cmdFilter_Click"
                    ContextMenu="{StaticResource FilterContextMenu}"
                    Style="{StaticResource ControlButton}">

                    <Image
                        Width="26"
                        Height="24"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        Source="/Images/filter.png" />
                </Button>


                <Button
                    x:Name="cmdSort"
                    Grid.Column="2"
                    Width="36"
                    Height="30"
                    Style="{StaticResource ControlButton}">
                    <Image
                        Width="26"
                        Height="24"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        Source="/Images/sort.png" />
                </Button>
            </Grid>


            <!--  Left Panel Space  -->
            <StackPanel
                Grid.Row="2"
                Grid.Column="0"
                Margin="2,10,2,10">

                <!--  Command="{Binding NewVaultEntryCommand}"  -->
                <Menu:MenuCmd
                    Width="90"
                    Height="35"
                    Margin="0,5,0,5"
                    Command="{Binding NewVaultEntryCommand}"
                    IsChecked="False"
                    Style="{StaticResource SideCmdStyle}">
                    <!--  NEW BUTTON  -->
                    <Grid Margin="-10,0,0,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <Image
                            x:Name="img_NewRecord"
                            Grid.Column="0"
                            Width="25"
                            Height="25">
                            <Image.Source>
                                <BitmapImage UriSource="Images/New.png" />
                            </Image.Source>
                        </Image>
                        <TextBlock
                            x:Name="cmd_NewRecord"
                            Grid.Column="1"
                            Width="40"
                            Height="17"
                            Margin="5,7,0,0"
                            VerticalAlignment="Top"
                            Style="{StaticResource TextStyle}"
                            Text="New" />
                    </Grid>
                </Menu:MenuCmd>

                <!--  EDIT BUTTON  -->
                <Menu:MenuCmd
                    Width="90"
                    Height="35"
                    Margin="0,5,0,5"
                    Command="{Binding EditVaultEntryCommand}"
                    CommandParameter="{Binding SelectedAppVault, Source={StaticResource PasswdPanelVM}}"
                    IsChecked="False"
                    Style="{StaticResource SideCmdStyle}">
                    <Grid Margin="-10,0,0,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <Image
                            x:Name="img_EditRecord"
                            Grid.Column="0"
                            Width="25"
                            Height="25">
                            <Image.Source>
                                <BitmapImage UriSource="Images/Edit.png" />
                            </Image.Source>
                        </Image>
                        <TextBlock
                            x:Name="cmd_EditRecord"
                            Grid.Column="1"
                            Width="40"
                            Height="17"
                            Margin="5,7,0,0"
                            VerticalAlignment="Top"
                            Style="{StaticResource TextStyle}"
                            Text="Edit" />
                    </Grid>
                </Menu:MenuCmd>


                <!--  SETTINGS BUTTON  -->
                <Menu:MenuCmd
                    Width="90"
                    Height="35"
                    Margin="0,5,0,5"
                    Command="{Binding OpenSettingsCommand}"
                    IsChecked="False"
                    Style="{StaticResource SideCmdStyle}">
                    <Grid Margin="-10,0,-8,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <Image
                            x:Name="img_settings"
                            Grid.Column="0"
                            Width="25"
                            Height="25">
                            <Image.Source>
                                <BitmapImage UriSource="Images/img_setting.png" />
                            </Image.Source>
                        </Image>
                        <TextBlock
                            x:Name="cmd_OpenSettings"
                            Grid.Column="1"
                            Height="21"
                            Margin="5,0,0,0"
                            VerticalAlignment="Center"
                            Style="{StaticResource TextStyle}"
                            Text="Settings" />
                    </Grid>
                </Menu:MenuCmd>


                <!--  ABOUT BUTTON  -->
                <Menu:MenuCmd
                    Width="90"
                    Height="35"
                    Margin="0,5,0,5"
                    Command="{Binding OpenAboutCommand}"
                    IsChecked="False"
                    Style="{StaticResource SideCmdStyle}">
                    <Grid Margin="-10,0,-8,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <Image
                            x:Name="img_about"
                            Grid.Column="0"
                            Width="25"
                            Height="25">
                            <Image.Source>
                                <BitmapImage UriSource="Images/about.png" />
                            </Image.Source>
                        </Image>
                        <TextBlock
                            x:Name="cmd_OpenAbout"
                            Grid.Column="1"
                            Height="21"
                            Margin="5,0,0,0"
                            VerticalAlignment="Center"
                            Style="{StaticResource TextStyle}"
                            Text="About" />
                    </Grid>
                </Menu:MenuCmd>


                <!--  DELETE BUTTON  -->
                <Menu:MenuCmd
                    Width="90"
                    Height="35"
                    Margin="0,5,0,5"
                    Command="{Binding DeleteVaultEntryCommand}"
                    CommandParameter="{Binding SelectedAppVault}"
                    IsChecked="False"
                    Style="{StaticResource SideCmdStyle}">
                    <Grid Margin="-10,0,0,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <Image
                            x:Name="img_DeleteRecord"
                            Grid.Column="0"
                            Width="25"
                            Height="25">
                            <Image.Source>
                                <BitmapImage UriSource="Images/Delete.png" />
                            </Image.Source>
                        </Image>
                        <TextBlock
                            x:Name="cmd_DeleteRecord"
                            Grid.Column="1"
                            Width="45"
                            Height="17"
                            Margin="5,7,0,0"
                            VerticalAlignment="Top"
                            Style="{StaticResource TextStyle}"
                            Text="Delete" />
                    </Grid>
                </Menu:MenuCmd>
            </StackPanel>

            <ScrollViewer Grid.Row="2" Grid.Column="1">
                <ListBox
                    Background="Transparent"
                    BorderThickness="0"
                    ItemsSource="{Binding Vaults}"
                    PreviewKeyDown="ListBox_PreviewKeyDown"
                    SelectedItem="{Binding SelectedAppVault}">

                    <!--  Bind double-click & Enter at the ListBox level  -->
                    <ListBox.InputBindings>
                        <MouseBinding
                            Command="{Binding DataContext.EditVaultEntryCommand, RelativeSource={RelativeSource AncestorType=ListBox}}"
                            CommandParameter="{Binding SelectedItem, RelativeSource={RelativeSource AncestorType=ListBox}}"
                            MouseAction="LeftDoubleClick" />
                        <KeyBinding
                            Key="Enter"
                            Command="{Binding DataContext.EditVaultEntryCommand, RelativeSource={RelativeSource AncestorType=ListBox}}"
                            CommandParameter="{Binding SelectedItem, RelativeSource={RelativeSource AncestorType=ListBox}}" />


                    </ListBox.InputBindings>

                    <ListBox.ItemContainerStyle>
                        <Style TargetType="ListBoxItem">
                            <Setter Property="Padding" Value="0" />
                            <Setter Property="BorderThickness" Value="0" />
                            <Setter Property="Background" Value="Transparent" />
                            <Style.Triggers>
                                <Trigger Property="IsSelected" Value="True">
                                    <Setter Property="BorderBrush" Value="#FF27D644" />
                                    <Setter Property="BorderThickness" Value="3" />
                                    <Setter Property="Background" Value="#1A27D644" />
                                </Trigger>
                            </Style.Triggers>

                        </Style>
                    </ListBox.ItemContainerStyle>

                    <ListBox.ItemTemplate>
                        <DataTemplate DataType="{x:Type m:AppVault}">
                            <v:PasswordPanel />
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
            </ScrollViewer>


            <!--  Footer Controls  -->
            <Grid Grid.Row="3" Grid.Column="1">
                <TextBlock
                    x:Name="lblStat"
                    Margin="50,0,0,0"
                    HorizontalAlignment="Left"
                    VerticalAlignment="Center"
                    Style="{StaticResource StatusText}"
                    Text="Status" />

                <Button
                    x:Name="cmd_Close"
                    Margin="0,0,10,0"
                    HorizontalAlignment="Right"
                    VerticalAlignment="Center"
                    Click="cmdClose_Click"
                    Content="Close"
                    Style="{StaticResource ControlButton}" />
            </Grid>
        </Grid>
    </Border>
</Window>
